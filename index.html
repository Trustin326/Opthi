<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Ophthalmic Surgeon's Widget</title>
  <meta name="theme-color" content="#0e2a47">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="assets/icons/logo.svg" alt="logo" class="logo">
      <div>
        <h1>Ophthalmic Widget Pro</h1>
        <p class="tag">Quick tools for clinic & OR (local-only demo)</p>
      </div>
    </div>
    <div class="header-actions">
      <button id="installBtn" class="btn ghost" title="Install as app">‚ûï Install</button>
      <button id="lockBtn" class="btn ghost" title="Lock/Unlock">üîí Lock</button>
    </div>
  </header>

  <section class="disclaimer">
    <strong>Clinical disclaimer:</strong> Demo-only tool. Data is stored on this device. Do not store Protected Health Information (PHI) unless your legal/privacy requirements are met. Calculators are simplified and must be independently verified before clinical use.
  </section>

  <nav class="tabs">
    <button class="tab active" data-tab="patients">üìù Patients</button>
    <button class="tab" data-tab="checklists">‚úÖ Checklists</button>
    <button class="tab" data-tab="calculators">üìê Calculators</button>
    <button class="tab" data-tab="images">üìä Scans</button>
    <button class="tab" data-tab="library">üìö Library</button>
    <button class="tab" data-tab="settings">‚öôÔ∏è Settings</button>
  </nav>

  <main>
    <!-- Patients -->
    <section id="patients" class="panel active">
      <div class="panel-head">
        <h2>Patient Notes (Local)</h2>
        <button class="btn" id="newPatientBtn">+ New</button>
      </div>
      <div id="patientList" class="cards"></div>

      <dialog id="patientDialog">
        <form method="dialog" class="dialog-form" id="patientForm">
          <h3 id="patientDialogTitle">New Patient</h3>
          <input type="hidden" id="patientId">
          <label>Identifier / Initials
            <input id="p_identifier" required placeholder="e.g., JD-001">
          </label>
          <label>Diagnosis / Plan
            <textarea id="p_plan" rows="3" placeholder="Dx: Cataract OD; Plan: Phaco + IOL"></textarea>
          </label>
          <div class="grid-2">
            <label>Target Refraction (D)
              <input id="p_target" type="number" step="0.01" placeholder="-0.25">
            </label>
            <label>Allergies
              <input id="p_allergies" placeholder="e.g., sulfa">
            </label>
          </div>
          <div class="grid-2">
            <label>Planned IOL
              <input id="p_iol" placeholder="e.g., AcrySof IQ SN60WF">
            </label>
            <label>Follow-up Reminder
              <input id="p_followup" type="datetime-local">
            </label>
          </div>
          <menu class="dialog-actions">
            <button class="btn ghost" value="cancel">Cancel</button>
            <button class="btn" value="default" id="savePatientBtn">Save</button>
          </menu>
        </form>
      </dialog>
    </section>

    <!-- Checklists -->
    <section id="checklists" class="panel">
      <div class="panel-head">
        <h2>Procedure Checklists</h2>
        <select id="checklistTemplate">
          <option value="cataract">Cataract</option>
          <option value="lasik">LASIK/SMILE</option>
          <option value="glaucoma">Glaucoma</option>
          <option value="retina">Retina</option>
          <option value="cornea">Cornea</option>
        </select>
        <button class="btn" id="loadChecklist">Load</button>
        <button class="btn ghost" id="addChecklistItem">+ Item</button>
      </div>
      <ul id="checklistItems" class="checklist"></ul>
      <div class="panel-foot">
        <button class="btn danger" id="clearChecklist">Clear</button>
        <button class="btn" id="saveChecklist">Save</button>
      </div>
    </section>

    <!-- Calculators -->
    <section id="calculators" class="panel">
      <h2>Calculators</h2>
      <div class="calc-grid">
        <div class="card">
          <h3>IOL Power (SRK II)</h3>
          <p class="muted">P ‚âà A ‚àí 2.5¬∑L ‚àí 0.9¬∑K</p>
          <label>A-constant <input id="srkA" type="number" value="118.0" step="0.01"></label>
          <label>Axial length L (mm) <input id="srkL" type="number" step="0.01"></label>
          <label>Keratometry K (D) <input id="srkK" type="number" step="0.01"></label>
          <button class="btn" id="calcSRK">Compute</button>
          <output id="srkResult"></output>
        </div>

        <div class="card">
          <h3>Drop Schedule Builder</h3>
          <label>Label <input id="dropLabel" placeholder="e.g., Prednisolone acetate 1%"></label>
          <label>Frequency/day <input id="dropFreq" type="number" min="1" max="12" value="4"></label>
          <label>Duration (days) <input id="dropDays" type="number" min="1" max="42" value="14"></label>
          <button class="btn" id="buildDrops">Build Schedule</button>
          <div id="dropPlan" class="plan"></div>
        </div>

        <div class="card">
          <h3>Drug Reference (Local)</h3>
          <div class="searchbar">
            <input id="drugQuery" placeholder="Search (e.g., moxifloxacin)">
            <button class="btn ghost" id="drugSearch">Search</button>
          </div>
          <div id="drugResults" class="list"></div>
          <p class="muted tiny">Always verify dosing in your formulary/hospital guidance.</p>
        </div>
      </div>
    </section>

    <!-- Scans -->
    <section id="images" class="panel">
      <div class="panel-head">
        <h2>Scans & Photos (device-only)</h2>
        <input type="file" id="imgInput" accept="image/*" multiple>
      </div>
      <div id="imgGrid" class="img-grid"></div>
    </section>

    <!-- Library -->
    <section id="library" class="panel">
      <h2>Quick Library</h2>
      <ul class="link-list">
        <li><a href="https://emedicine.medscape.com/ophthalmology" rel="noopener" target="_blank">General Ophthalmology Overview</a></li>
        <li><a href="https://eyewiki.aao.org/" rel="noopener" target="_blank">EyeWiki (AAO)</a></li>
        <li><a href="https://aao.org/clinical-education" rel="noopener" target="_blank">AAO Clinical Education</a></li>
        <li><a href="https://ascrs.org/clinical-education" rel="noopener" target="_blank">ASCRS Clinical Education</a></li>
      </ul>
      <p class="muted tiny">External links open in a new tab. This app does not send any data to these sites.</p>
    </section>

    <!-- Settings -->
    <section id="settings" class="panel">
      <h2>Settings & Security</h2>
      <div class="card">
        <h3>App Lock (PIN)</h3>
        <label>Set/Change PIN
          <input id="pinInput" type="password" placeholder="4-8 digits">
        </label>
        <button class="btn" id="setPinBtn">Save PIN</button>
        <p class="muted tiny">Lightweight gate. For PHI, use a HIPAA-compliant system.</p>
      </div>

      <div class="card">
        <h3>Export / Import</h3>
        <button class="btn" id="exportBtn">Export Data (JSON)</button>
        <label class="file-btn">Import Data (JSON)
          <input type="file" id="importInput" accept="application/json">
        </label>
      </div>

      <div class="card">
        <h3>Notifications</h3>
        <button class="btn" id="notifBtn">Enable Notifications</button>
        <p class="muted tiny">Follow-up reminders trigger while the app is open. For system-level scheduling, use native iOS/Android.</p>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span>Ophthalmic Widget Pro ‚Äî PWA demo</span>
    <a href="#" id="aboutLink">About</a>
  </footer>

  <dialog id="aboutDialog">
    <form method="dialog" class="dialog-form">
      <h3>About</h3>
      <p>This local-first widget is a progressive web app (PWA). You can install it to your home screen. No server required.</p>
      <ul class="bullets">
        <li>Patients & notes stored in browser localStorage</li>
        <li>Optional PIN gate</li>
        <li>IOL (SRK II) calculator</li>
        <li>Drop schedule builder</li>
        <li>Local image viewer</li>
        <li>Offline support via Service Worker</li>
      </ul>
      <menu class="dialog-actions">
        <button class="btn">Close</button>
      </menu>
    </form>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
